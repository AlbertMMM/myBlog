<!doctype html><html lang=en><head><title>How to mine Ethereum on Ubuntu 20.04. LTS :: Albert's blog — A blog about technology</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Prerequisites A working installation of Ubuntu 20.04 LTS is required. An Advanced user can install the server version while a neophyte can install the desktop version. The installation process for the Ubuntu Server Edition is slightly different from the Desktop Edition; Ubuntu Server doesn&amp;rsquo;t have a GUI by default. The guide assumes you have root privileges to the system. This guide also assumes you already have the necessary hardware to mine Ethereum using the ETHASH algorithm."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=blog.albertbling.com/posts/how-to-mine-ethereum-on-linux/><link rel=stylesheet href=blog.albertbling.com/assets/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=blog.albertbling.com/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=blog.albertbling.com/img/favicon/orange.png><meta name=twitter:card content="summary"><meta name=twitter:creator content="Albert"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="How to mine Ethereum on Ubuntu  20.04. LTS :: Albert's blog"><meta property="og:description" content="Prerequisites A working installation of Ubuntu 20.04 LTS is required. An Advanced user can install the server version while a neophyte can install the desktop version. The installation process for the Ubuntu Server Edition is slightly different from the Desktop Edition; Ubuntu Server doesn&amp;rsquo;t have a GUI by default. The guide assumes you have root privileges to the system. This guide also assumes you already have the necessary hardware to mine Ethereum using the ETHASH algorithm."><meta property="og:url" content="blog.albertbling.com/posts/how-to-mine-ethereum-on-linux/"><meta property="og:site_name" content="How to mine Ethereum on Ubuntu  20.04. LTS"><meta property="og:image" content="blog.albertbling.com/img/favicon/orange.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2020-11-20 00:00:00 +0000 UTC"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Albert</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=blog.albertbling.com/about>About</a></li><li><a href=blog.albertbling.com/posts>Posts</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=blog.albertbling.com/about>About</a></li><li><a href=blog.albertbling.com/posts>Posts</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=blog.albertbling.com/posts/how-to-mine-ethereum-on-linux/>How to mine Ethereum on Ubuntu 20.04. LTS</a></h1><div class=post-meta><span class=post-date>2020-11-20 [Updated: 2020-11-20]</span>
<span class=post-author>::
Albert</span></div><div class=post-content><div><h1 id=prerequisites>Prerequisites<a href=#prerequisites class=hanchor arialabel=Anchor>&#8983;</a></h1><p>A working installation of <a href=https://releases.ubuntu.com/20.04/>Ubuntu 20.04 LTS</a> is required. An Advanced user can install the server version while a neophyte can install the desktop version. The installation process for the Ubuntu Server Edition is slightly different from the Desktop Edition; Ubuntu Server doesn&rsquo;t have a GUI by default. The guide assumes you have root privileges to the system.
This guide also assumes you already have the necessary hardware to mine Ethereum using the ETHASH algorithm.</p><h3 id=disclaimer>disclaimer<a href=#disclaimer class=hanchor arialabel=Anchor>&#8983;</a></h3><p>This guide was tested using 5 AMD RX580 gpu&rsquo;s with 8GB GDDR5 memory (samsung).<div class=collapsable-code><input id=1 type=checkbox>
<label for=1><span class=collapsable-code__language>bash</span>
<span class=collapsable-code__title>update ubuntu</span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-bash><code>
#!/bin/sh
Sudo apt install &amp; sudo apt upgrade
sudo apt install nano
</code></pre></div></p><h2 id=enable--kernel-boot-option-that-allows-control-of-gpu-power-states>Enable kernel boot option that allows control of GPU power states<a href=#enable--kernel-boot-option-that-allows-control-of-gpu-power-states class=hanchor arialabel=Anchor>&#8983;</a></h2><p>To enable undervolting and overclocking of AMD GPU&rsquo;s, A &ldquo;ppfeaturemask&rdquo; Kernel Parameter Is Required. This is often accomplished via a system&rsquo;s
boot loader (E.g. GRUB). If manually loading the driver, pass ppfeaturemask= as a modprobe parameter.</p><ul><li>Replace <code>GRUB_CMDLINE_LINUX_DEFAULT</code> and <code>GRUB_CMDLINE_LINUX</code> lines with the parameters below:</li></ul><div class=collapsable-code><input id=2 type=checkbox>
<label for=2><span class=collapsable-code__language>sh</span>
<span class=collapsable-code__title>edit Grub config</span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-sh><code>
sudo nano /etc/default/grub
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>GRUB_CMDLINE_LINUX_DEFAULT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;amdgpu.ppfeaturemask=0xfffd7fff&#34;</span>
GRUB_CMDLINE_LINUX<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;net.ifnames=0 biosdevname=0&#34;</span>

</code></pre></div><p>You can also use <code>amdgpu.ppfeaturemask=0xffffffff</code> but a higher value causes artifacts on some models under the RX 400/500 series.</p><div class=collapsable-code><input id=3 type=checkbox>
<label for=3><span class=collapsable-code__language>sh</span>
<span class=collapsable-code__title>update Grub config</span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-sh><code>
sudo update-grub &amp;&amp; sudo update-grub2 &amp;&amp; sudo update-initramfs -u -k all

</code></pre></div><h2 id=install-amdgpu-driver--opencl>Install AMDGPU Driver + OpenCL<a href=#install-amdgpu-driver--opencl class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The commands below simplify the installation of the AMDGPU graphics and compute stack by encapsulating the distribution specific package installation logic by using command line options that allow specifying the Variant of the AMDGPU stack to be installed. For GPU mining, we will be using the Pro variant only.</p><p><code>Download the driver</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>wget https://drivers.amd.com/drivers/linux/amdgpu-pro-20.40-1147286-ubuntu-20.04.tar.xz --referer https://www.amd.com/en/support/kb/release-notes/rn-amdgpu-unified-linux-20-40
</code></pre></div><div class=collapsable-code><input id=163578924 type=checkbox>
<label for=163578924><span class=collapsable-code__language>sh</span>
<span class=collapsable-code__title><code>Extract the tallbar</code></span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-sh><code>
 tar -Jxvf amdgpu-pro-20.40-1147286-ubuntu-20.04.tar.xz
</code></pre></div><div class=collapsable-code><input id=395841672 type=checkbox>
<label for=395841672><span class=collapsable-code__language>sh</span>
<span class=collapsable-code__title><code>Change Directory to driver folder</code></span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-sh><code>
cd amdgpu-pro-20.40-1147286-ubuntu-20.04.tar.xz
</code></pre></div><div class=collapsable-code><input id=987253641 type=checkbox>
<label for=987253641><span class=collapsable-code__language>sh</span>
<span class=collapsable-code__title><code>install Pro drivers</code></span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-sh><code>
./amdgpu-pro-install -y --opencl=pal,legacy,rocm --headless
</code></pre></div><p>The parameters <code>--opencl=pal,legacy,rocm</code> specify the OpenCl implementation to install. OpenCL is an optional component of the Pro variant and is installed only if it is specifically requested.</p><table><thead><tr><th style=text-align:left>Option</th><th style=text-align:center>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>Pal</code></td><td style=text-align:center>Provides support for Vega 10 and newer hardware.</td></tr><tr><td style=text-align:left><code>Legacy</code></td><td style=text-align:center>Provides support for hardware older than Vega 10</td></tr><tr><td style=text-align:left><code>rocm</code></td><td style=text-align:center>Optional component</td></tr></tbody></table><p>The parameter <code>--headless</code> specifies to install only the OpenCL portion of the Pro variant (omitting the OpenGL portion). This is desirable because the GPU&rsquo;s will be operating in headless compute mode.</p><p><code>optional</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-s data-lang=s>sudo apt install amdgpu<span style=color:#f92672>-</span>dkms libdrm<span style=color:#f92672>-</span>amdgpu<span style=color:#f92672>-</span>amdgpu1 libdrm2<span style=color:#f92672>-</span>amdgpu opencl<span style=color:#f92672>-</span>amdgpu<span style=color:#f92672>-</span>pro opencl<span style=color:#f92672>-</span>amdgpu<span style=color:#f92672>-</span>pro<span style=color:#f92672>-</span>dev
</code></pre></div><h3 id=add-yourself-to-the-video-and-render-group>Add yourself to the Video and Render group<a href=#add-yourself-to-the-video-and-render-group class=hanchor arialabel=Anchor>&#8983;</a></h3><p>To access the GPU&rsquo;s, you must be a user in the video and render groups.<br><strong>Note:</strong> render group is required only for Ubuntu v20.04.</p><div class=collapsable-code><input id=129564378 type=checkbox>
<label for=129564378><span class=collapsable-code__language>sh</span>
<span class=collapsable-code__title><code>add user to vid and render group</code></span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-sh><code>
sudo usermod -a -G video $LOGNAME
sudo usermod -a -G render $LOGNAME
</code></pre></div><p>By default, you must add any future users to the video and render groups. To add future users to the video and render groups, run the following optional command:<div class=collapsable-code><input id=965182437 type=checkbox>
<label for=965182437><span class=collapsable-code__language>sh</span>
<span class=collapsable-code__title><code>add future user to vid and render group</code></span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-sh><code>
echo &#39;ADD_EXTRA_GROUPS=1&#39; | sudo tee -a /etc/adduser.conf
echo &#39;EXTRA_GROUPS=video&#39; | sudo tee -a /etc/adduser.conf
echo &#39;EXTRA_GROUPS=render&#39; | sudo tee -a /etc/adduser.conf
</code></pre></div></p><h2 id=add-amdgpu-pro-path-to-new-line>Add amdgpu-pro PATH to new line<a href=#add-amdgpu-pro-path-to-new-line class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=collapsable-code><input id=498172635 type=checkbox>
<label for=498172635><span class=collapsable-code__language>sh</span>
<span class=collapsable-code__title><code>edit ~profile</code></span>
<span class=collapsable-code__toggle data-label-expand=△ data-label-collapse=▽></span></label><pre class=language-sh><code>
Export PATH=&#34;/opt/amdgpu-pro/bin:$PATH&#34;
</code></pre></div><h3 id=hard-reboot>Hard reboot<a href=#hard-reboot class=hanchor arialabel=Anchor>&#8983;</a></h3><p>It would be safer to do a Alt+SysRq+(R,E,I,S,U,B or O) than force a <em>hard</em> reboot.</p><ul><li>R Switch the keyboard from raw mode to XLATE mode</li><li>E SIGTERM everything except init</li><li>I SIGKILL everything except init</li><li>S Syncs the mounted filesystem</li><li>U Remounts the mounted filesystem in read-only mode</li><li>B Reboot the system, or O Turn off the system</li></ul><p>You could just Alt+SysRq+B/O to reboot/halt if you really desirable but you put your filesystem at risk by doing so. Doing all of the above is relatively safe and should work even when the rest of the system has broken down.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>
    <span style=color:#66d9ef>for</span> i in s u b; <span style=color:#66d9ef>do</span> echo $i | sudo tee /proc/sysrq-trigger; sleep 5; <span style=color:#66d9ef>done</span>  <span style=color:#75715e># reboot</span>
    <span style=color:#66d9ef>for</span> i in s u o; <span style=color:#66d9ef>do</span> echo $i | sudo tee /proc/sysrq-trigger; sleep 5; <span style=color:#66d9ef>done</span>  <span style=color:#75715e># halt</span>
</code></pre></div><p>Data loss is possible from running applications but it shouldn&rsquo;t knacker your filesystem. If you a have particularly huge disk write caches it might be best to increase the <code>sleep</code> value.</p><h2 id=install-and-run-your-favorite-miner>Install and run your favorite miner<a href=#install-and-run-your-favorite-miner class=hanchor arialabel=Anchor>&#8983;</a></h2><h2 id=install-rocm-system-management-interface>Install ROCm System Management Interface<a href=#install-rocm-system-management-interface class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The <code>rocm-smi</code> tool exposes functionality for clock, power and temperature management of your system. We will be running the tool directly in this guide instead.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-s data-lang=s>wget https<span style=color:#f92672>://</span>github.com<span style=color:#f92672>/</span>RadeonOpenCompute<span style=color:#f92672>/</span>ROC<span style=color:#f92672>-</span>smi<span style=color:#f92672>/</span>archive<span style=color:#f92672>/</span>rocm<span style=color:#ae81ff>-3.9.0</span>.tar.gz
</code></pre></div><table><thead><tr><th style=text-align:left>Option</th><th style=text-align:center>Description</th></tr></thead><tbody><tr><td style=text-align:left>&ndash;setsclk LEVEL [LEVEL &mldr;]</td><td style=text-align:center>Set GPU Clock Frequency Level(s) (requires manual Perf level)</td></tr><tr><td style=text-align:left>&ndash;setmclk LEVEL [LEVEL &mldr;]</td><td style=text-align:center>Set GPU Memory Clock Frequency Level(s) (requires manual Perf level)</td></tr><tr><td style=text-align:left>&ndash;setpcie LEVEL [LEVEL &mldr;]</td><td style=text-align:center>Set PCIE Clock Frequency Level(s) (requires manual Perf level)</td></tr><tr><td style=text-align:left>&ndash;setslevel SCLKLEVEL SCLK SVOLT</td><td style=text-align:center>Change GPU Clock frequency (MHz) and Voltage (mV) for a specific Level</td></tr><tr><td style=text-align:left>&ndash;setmlevel MCLKLEVEL MCLK MVOLT</td><td style=text-align:center>Change GPU Memory clock frequency (MHz) and Voltage for (mV) a specific Level</td></tr><tr><td style=text-align:left>&ndash;setfan LEVEL</td><td style=text-align:center>Set GPU Fan Speed (Level or %)</td></tr><tr><td style=text-align:left>&ndash;setperflevel LEVEL</td><td style=text-align:center>Set Performance Level</td></tr><tr><td style=text-align:left>&ndash;setoverdrive %</td><td style=text-align:center>Set GPU OverDrive level (requires manual</td></tr><tr><td style=text-align:left>&ndash;setmemoverdrive %</td><td style=text-align:center>Set GPU Memory Overclock OverDrive level (requires manual</td></tr><tr><td style=text-align:left>&ndash;setpoweroverdrive WATTS</td><td style=text-align:center>Set the maximum GPU power using Power OverDrive in Watts</td></tr></tbody></table><p>Read more about the tool on github <a href=https://github.com/RadeonOpenCompute/ROC-smi>here</a></p></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2020 :: Albert Bling</span></div></div></footer><script src=blog.albertbling.com/assets/main.js></script><script src=blog.albertbling.com/assets/prism.js></script></div></body></html>